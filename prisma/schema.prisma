generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Registration {
  accountId        Int     @id @default(autoincrement()) @map("Account_ID")
  email            String  @unique @map("Email_ID")
  totalCredits     Int     @default(0) @map("Total_Credits")
  consumedCredits  Int     @default(0) @map("Consumed_Credits")
  remainingCredits Int     @default(0) @map("Remaining_Credits")
  active           Boolean @default(true) @map("Active")

  // JSON profile, no native type
  profile Json? @map("Profile")

  createdAt DateTime @default(now()) @map("Created_At")
  updatedAt DateTime @updatedAt @map("Updated_At")

  @@map("credits")
}

model Document {
  id            String    @id @default(cuid())
  accountId     Int
  email         String
  originalName  String
  filePath      String
  contentType   String
  sizeBytes     Int
  sha256        String?
  status        String    @default("READY")
  lastExtractAt DateTime?
  extractResult Json?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  @@index([accountId, createdAt])
  @@index([email])
  @@index([sha256])
}

model User {
  id               String       @id @default(cuid())
  email            String       @unique
  passwordHash     String
  name             String?
  plan             String? // "free" | "basic" | "premium"
  billingCycle     String? // "monthly" | "yearly"
  status           String? // "inactive" | "pending_payment" | "active"
  stripeCustomerId String?      @unique
  emailVerified    DateTime? // <-- add this
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  EmailToken       EmailToken[]
}

/**
 * NEW: hashed, expiring, one-time tokens
 */
model EmailVerifyToken {
  id         String    @id @default(cuid())
  identifier String // email
  tokenHash  String    @unique
  expires    DateTime
  createdAt  DateTime  @default(now())
  consumedAt DateTime?

  @@index([identifier])
  @@index([expires])
}

model EmailToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  email     String
  expiresAt DateTime
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("email_verify_tokens") // table name in DB (optional, keep if you like this)
}
